(function(a){if(!window.jQuery){alert("jQuery is required.")}jQuery(function(){a.call(null,jQuery)})})(function(c){var d=(function(){var f=1600;var e=WebUploader;var j=e.Uploader;var h=c(".uploader-container");var i,g;if(!j.support()){alert("Web Uploader 不支持您的浏览器！");throw new Error("WebUploader does not support the browser you are using.")}j.register({"before-send-file":"cropImage"},{cropImage:function(l){var m=l._cropData,n,k;l=this.request("get-file",l);k=e.Deferred();n=new e.Lib.Image();k.always(function(){n.destroy();n=null});n.once("error",k.reject);n.once("load",function(){n.crop(m.x,m.y,m.width,m.height,m.scale)});n.once("complete",function(){var o,p;try{o=n.getAsBlob();p=l.size;l.source=o;l.size=o.size;l.trigger("resize",o.size,p);k.resolve()}catch(q){console.log(q);k.resolve()}});l._info&&n.info(l._info);l._meta&&n.meta(l._meta);n.loadFromBlob(l.source);return k.promise()}});return{init:function(k){i=new j({pick:{id:"#filePicker",multiple:false},thumb:{quality:70,allowMagnify:false,crop:false},chunked:false,compress:false,server:"../server/fileupload.php",swf:"../Uploader.swf",fileNumLimit:1,onError:function(){var l=[].slice.call(arguments,0);alert(l.join("\n"))}});i.on("fileQueued",function(l){g=l;i.makeThumb(g,function(m,n){if(m){alert("不能预览");return}k(n)},f,1)})},crop:function(k){var l=a.getImageSize().width/g._info.width;k.scale=l;g._cropData={x:k.x1,y:k.y1,width:k.width,height:k.height,scale:k.scale}},upload:function(){i.upload()}}})();var a=(function(){var e=c(".cropper-wraper");var g=e.find(".img-container img");var f=c(".upload-btn");var i,j;g.cropper({aspectRatio:16/9,preview:".img-preview",done:function(k){}});function h(l,k){if(typeof i==="undefined"){(function(){var n=new Image();var m=true;n.onload=n.onerror=function(){if(this.width!=1||this.height!=1){m=false}};n.src=l;i=m})()}if(i){k(l)}else{c.ajax("../server/preview.php",{method:"POST",data:l,dataType:"json"}).done(function(m){if(m.result){k(m.result)}else{alert("预览出错")}})}}f.on("click",function(){j&&j(g.cropper("getData"));return false});return{setSource:function(k){h(k,function(l){g.cropper("setImgSrc",l)});e.removeClass("webuploader-element-invisible");return this},getImageSize:function(){var k=g.get(0);return{width:k.naturalWidth,height:k.naturalHeight}},setCallback:function(k){j=k;return this},disable:function(){g.cropper("disable");return this},enable:function(){g.cropper("enable");return this}}})();var b=c(".uploader-container");d.init(function(e){a.setSource(e);b.addClass("webuploader-element-invisible");a.setCallback(function(f){d.crop(f);d.upload()})})});
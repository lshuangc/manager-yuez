/*!
 * Cropper v0.3.2
 * https://github.com/fengyuanchen/cropper
 *
 * Copyright 2014 Fengyuan Chen
 * Released under the MIT license
 */
(function(a){if(typeof define==="function"&&define.amd){define(["jquery"],a)}else{a(jQuery)}}(function(b){var c=b(window),a=function(e,d){d=b.isPlainObject(d)?d:{};this.$image=b(e);this.defaults=b.extend({},a.defaults,this.$image.data(),d);this.init()};a.prototype={construstor:a,init:function(){this.setAspectRatio(this.defaults.aspectRatio);this.render()},render:function(h){var e=this,d=this.$image,f,g;if(this.active){return}if(this.$clone){this.$clone.remove()}g=d.attr("src");f=b('<img src="'+g+'">');f.on("load",function(){var i;f.off("load");if(this.naturalWidth&&this.naturalHeight){i={naturalHeight:this.naturalHeight,naturalWidth:this.naturalWidth}}else{a.fn.size(f,{height:"auto",width:"auto"});i=a.fn.size(f);i={naturalHeight:i.height,naturalWidth:i.width}}a.fn.size(f,{height:"100%",width:"100%"});i.aspectRatio=i.naturalWidth/i.naturalHeight;e.src=g;e.image=i;e.active=true;e.createCropper()});if(b.isFunction(h)){d.on("ready.cropper",h)}this.$clone=f;d.after(f)},unrender:function(){if(this.active){this.active=false;this.removeCropper();this.src="";this.image=null;this.cropper=null;this.dragger=null}},rerender:function(){this.unrender();this.render()},resize:function(){clearTimeout(this.resizing);this.resizing=setTimeout(b.proxy(this.rerender,this),200)},createCropper:function(){this.$cropper=b(a.template);this.$dragger=this.$cropper.find(".cropper-dragger");a.fn.toggle(this.$image);this.$image.after(this.$cropper);this.$cropper.prepend(this.$clone);if(!this.defaults.modal){a.fn.toggle(this.$cropper.find(".cropper-modal"))}this.setPreview();this.addListener()},removeCropper:function(){this.removeListener();this.$preview=null;this.$clone.remove();this.$clone=null;this.$dragger=null;this.$cropper.remove();this.$cropper=null;a.fn.toggle(this.$image)},addListener:function(){this.$cropper.bind("mousedown touchstart",b.proxy(this.dragstart,this));this.$cropper.bind("mousemove touchmove",b.proxy(this.dragmove,this));this.$cropper.bind("mouseup mouseleave touchend touchleave",b.proxy(this.dragend,this));c.on("resize",b.proxy(this.resize,this))},removeListener:function(){this.$cropper.unbind("mousedown touchstart",this.dragstart);this.$cropper.unbind("mousemove touchmove",this.dragmove);this.$cropper.unbind("mouseup mouseleave touchend touchleave",this.dragend);c.off("resize",this.resize)},setPreview:function(){var d=this.defaults.preview;this.$preview=this.$cropper.find(".cropper-preview");if(typeof d==="string"&&d.length>0){this.$preview=this.$preview.add(d)}this.$preview.html('<img src="'+this.src+'">');this.setCropper()},setCropper:function(){var g=this.$image.parent(),d=a.fn.size(g),f=this.image,e;if(((f.naturalWidth*d.height/f.naturalHeight)-d.width)>=0){e={height:d.width/f.aspectRatio,width:d.width,left:0};e.top=(d.height-e.height)/2}else{e={height:d.height,width:d.height*f.aspectRatio,top:0};e.left=(d.width-e.width)/2}b.each(e,function(h,j){e[h]=Math.round(j)});f.height=e.height;f.width=e.width;f.ratio=f.width/f.naturalWidth;a.fn.position(g);this.$cropper.css({height:e.height,left:e.left,top:e.top,width:e.width});this.cropper=e;this.setDragger()},setDragger:function(){var d=this.cropper,e=this.defaults.aspectRatio||this.image.aspectRatio,f;if(((d.height*e)-d.width)>=0){f={height:d.width/e,width:d.width,left:0,top:(d.height-(d.width/e))/2,maxWidth:d.width,maxHeight:d.width/e}}else{f={height:d.height,width:d.height*e,left:(d.width-(d.height*e))/2,top:0,maxHeight:d.height,maxWidth:d.height*e}}f.height*=0.8;f.width*=0.8;f.left=(d.width-f.width)/2;f.top=(d.height-f.height)/2;this.dragger=a.fn.round(f);this.setData(this.defaults.data);this.$image.trigger("ready.cropper").off("ready.cropper")},resetDragger:function(){var e=this.dragger,d=this.cropper;e.width=e.width>e.maxWidth?e.maxWidth:Math.abs(e.width);e.height=e.height>e.maxHeight?e.maxHeight:Math.abs(e.height);e.maxLeft=d.width-e.width;e.maxTop=d.height-e.height;e.left=e.left<0?0:e.left>e.maxLeft?e.maxLeft:e.left;e.top=e.top<0?0:e.top>e.maxTop?e.maxTop:e.top;e=a.fn.round(e);this.$dragger.css({height:e.height,left:e.left,top:e.top,width:e.width});this.dragger=e;this.preview();this.output()},dragging:function(){var g=this.direction,f=this.dragger,e=this.defaults.aspectRatio,d={x:this.endX-this.startX,y:this.endY-this.startY};if(e){d.X=d.y*e;d.Y=d.x/e}switch(g){case"e":f.width+=d.x;if(e){f.height=f.width/e;f.top-=d.Y/2}if(f.width<0){this.direction="w";f.width=0}break;case"n":f.height-=d.y;f.top+=d.y;if(e){f.width=f.height*e;f.left+=d.X/2}if(f.height<0){this.direction="s";f.height=0}break;case"w":f.width-=d.x;f.left+=d.x;if(e){f.height=f.width/e;f.top+=d.Y/2}if(f.width<0){this.direction="e";f.width=0}break;case"s":f.height+=d.y;if(e){f.width=f.height*e;f.left-=d.X/2}if(f.height<0){this.direction="n";f.height=0}break;case"ne":f.height-=d.y;f.top+=d.y;if(e){f.width=f.height*e}else{f.width+=d.x}if(f.height<0){this.direction="sw";f.height=0;f.width=0}break;case"nw":f.height-=d.y;f.top+=d.y;if(e){f.width=f.height*e;f.left+=d.X}else{f.width-=d.x;f.left+=d.x}if(f.height<0){this.direction="se";f.height=0;f.width=0}break;case"sw":f.width-=d.x;f.left+=d.x;if(e){f.height=f.width/e}else{f.height+=d.y}if(f.width<0){this.direction="ne";f.height=0;f.width=0}break;case"se":f.width+=d.x;if(e){f.height=f.width/e}else{f.height+=d.y}if(f.width<0){this.direction="nw";f.height=0;f.width=0}break;default:f.left+=d.x;f.top+=d.y}this.resetDragger();this.startX=this.endX;this.startY=this.endY},output:function(){this.defaults.done(this.getData())},preview:function(){var e=this,d=e.cropper,f=e.dragger;this.$preview.each(function(){var i=b(this),g=i.outerWidth()/f.width,h={height:d.height,marginLeft:-f.left,marginTop:-f.top,width:d.width};i.css({overflow:"hidden"});i.find("img").css(a.fn.round(h,function(j){return j*g}))})},enable:function(d){this.render(d)},disable:function(){this.unrender()},setAspectRatio:function(d){if(d==="auto"||(b.isNumeric(d)&&d>0)){this.defaults.aspectRatio=d==="auto"?NaN:d;if(this.active){this.setDragger()}}},setData:function(g){var e=this.cropper,h=this.dragger,f=this.defaults.aspectRatio,d=function(i){return typeof i==="number"};if(!this.active){return}if(b.isPlainObject(g)&&!b.isEmptyObject(g)){g=a.fn.transformData(g,this.image.ratio);if(d(g.x1)&&g.x1<=e.width){h.left=g.x1}if(d(g.y1)&&g.y1<=e.height){h.top=g.y1}if(f){if(d(g.width)&&g.width<=e.width){h.width=g.width;h.height=h.width/f}else{if(d(g.height)&&g.height<=e.height){h.height=g.height;h.width=h.height*f}else{if(d(g.x2)&&g.x2<=e.width){h.width=g.x2-h.left;h.height=h.width/f}else{if(d(g.y2)&&g.y2<=e.height){h.height=g.y2-h.top;h.width=h.height*f}}}}}else{if(d(g.width)&&g.width<=e.width){h.width=g.width}else{if(d(g.x2)&&g.x2<=e.width){h.width=g.x2-h.left}}if(d(g.height)&&g.height<=e.height){h.height=g.height}else{if(d(g.y2)&&g.height<=e.height){h.height=g.y2-h.top}}}}this.dragger=h;this.resetDragger()},getData:function(){var e=this.dragger,d={};if(this.active){d={x1:e.left,y1:e.top,width:e.width,height:e.height,x2:e.left+e.width,y2:e.top+e.height};d=a.fn.transformData(d,(1/this.image.ratio))}return d},setImgSrc:function(d){if(typeof d==="string"&&d.length>0&&d!==this.src){this.$image.attr("src",d);this.rerender()}},getImgInfo:function(){return this.image||{}},dragstart:function(f){var i=a.fn.getOriginalEvent(f).touches,h=f,d,g;if(i&&i.length===1){h=i[0];this.touchId=h.identifier;d=true}g=b(h.target).data().direction;if(a.fn.isDirection(g)){this.startX=h.pageX;this.startY=h.pageY;this.direction=g;this.$image.trigger("dragstart");d&&f.preventDefault()}},dragmove:function(f){var h=a.fn.getOriginalEvent(f).changedTouches,g=f,d;if(h&&h.length===1){g=h[0];d=true;if(g.identifier!==this.touchId){return}}if(this.direction){this.$image.trigger("dragmove");d&&f.preventDefault();this.endX=g.pageX;this.endY=g.pageY;this.dragging()}},dragend:function(f){var h=a.fn.getOriginalEvent(f).changedTouches,g=f,d;if(h&&h.length===1){g=h[0];d=true;if(g.identifier!==this.touchId){return}}if(this.direction){this.direction="";this.$image.trigger("dragend");d&&f.preventDefault()}}};a.fn={toggle:function(d){d.toggleClass("cropper-hidden")},position:function(e,f){var d=e.css("position");if(d==="static"){e.css("position",f||"relative")}},size:function(e,d){if(b.isPlainObject(d)){e.css(d)}else{return{height:e.height(),width:e.width()}}},round:function(g,e){var f,d;for(d in g){f=g[d];if(g.hasOwnProperty(d)&&typeof f==="number"){g[d]=Math.round(b.isFunction(e)?e(f):f)}}return g},transformData:function(g,e){var f=this,d={};b.each(g,function(h,j){if(f.isDataOption(h)&&b.isNumeric(j)&&j>=0){d[h]=Math.round(j*e)}});return d},getOriginalEvent:function(d){if(d&&typeof d.originalEvent!=="undefined"){d=d.originalEvent}return d},isDataOption:function(d){return/^(x1|y1|x2|y2|width|height)$/i.test(d)},isDirection:function(d){return/^(\*|e|n|w|s|ne|nw|sw|se)$/i.test(d)}};a.template=['<div class="cropper-container">','<div class="cropper-modal"></div>','<div class="cropper-dragger">','<span class="cropper-preview"></span>','<span class="cropper-dashed dashed-h"></span>','<span class="cropper-dashed dashed-v"></span>','<span class="cropper-face" data-direction="*"></span>','<span class="cropper-line line-e" data-direction="e"></span>','<span class="cropper-line line-n" data-direction="n"></span>','<span class="cropper-line line-w" data-direction="w"></span>','<span class="cropper-line line-s" data-direction="s"></span>','<span class="cropper-point point-e" data-direction="e"></span>','<span class="cropper-point point-n" data-direction="n"></span>','<span class="cropper-point point-w" data-direction="w"></span>','<span class="cropper-point point-s" data-direction="s"></span>','<span class="cropper-point point-ne" data-direction="ne"></span>','<span class="cropper-point point-nw" data-direction="nw"></span>','<span class="cropper-point point-sw" data-direction="sw"></span>','<span class="cropper-point point-se" data-direction="se"></span>',"</div>","</div>"].join("");a.defaults={aspectRatio:"auto",data:{},done:function(){},modal:true,preview:""};a.setDefaults=function(d){b.extend(a.defaults,d)};b.fn.cropper=function(e,f){var d=this;this.each(function(){var h=b(this),g=h.data("cropper");if(!g){g=new a(this,e);h.data("cropper",g)}if(typeof e==="string"&&b.isFunction(g[e])){d=g[e](f)}});return(typeof d!=="undefined"?d:this)};b.fn.cropper.Constructor=a;b.fn.cropper.setDefaults=a.setDefaults;b(function(){b("img[cropper]").cropper()})}));
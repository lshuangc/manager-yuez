var panel={init:function(){common.bind_Sanji();this.recommendPagIng()},remove_List:function(){$("#tbody").html(" ")},change_recommendType:function(b){var a=$(b).val();switch(a){case"1":this.remove_List();this.recommendPagIng(1);break;case"2":this.remove_List();this.secondHand(1);break}},btn_findByScreen:function(){var a=$("select[name = communityhouse-type]").val();switch(a){case"1":this.recommend_search();break;case"2":this.second_search();break}},bind_communitySelect:function(b){var a=$(b).val();$.ajax({type:"post",url:urlScope+"/Community/findByScreen",datatype:"json",data:{countyCode:a,page:1,rows:10},success:function(g){var f=JSON.parse(g);var c=document.getElementById("communityId");c.options[0]=new Option("全部"," ");var d=f.object.data;console.log(d.length);for(var e=0;e<d.length;e++){c.options[e+1]=new Option(d[e].name,d[e].id)}},error:function(c){layer.msg("网络错误",{icon:1,time:1000})}})},recommendPagIng:function(a){$.ajax({type:"post",url:urlScope+"/recommendRecord/houtaiByCommunity",dataType:"json",data:{page:a||1,rows:10},success:function(c){var b=panel.packQueryData(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel.recommendPagIng(d.curr)}}})},error:function(b){layer.msg("网络错误",{icon:1,time:1000})}})},secondHand:function(a){$.ajax({type:"post",url:urlScope+"/recommendRecord/houtaiByHouse",dataType:"json",data:{page:a||1,rows:10},success:function(c){var b=panel.packQueryData(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel.secondHand(d.curr)}}})},error:function(b){layer.msg("网络错误",{icon:1,time:1000})}})},updateTo2or6:function(a,b){switch(b){case 1:layer.confirm("请到详情页面确认信息，是否通过？<br/>通过：流转甲方确认&nbsp;&nbsp;驳回：终止此单",{btn:["通过","驳回"],title:"推荐单信息审核"},function(){layer.confirm("确定要通过审核吗？",function(){$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendFlow:"2",approveMessage:"推荐单已审核完毕,等待确认！"},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})})},function(){layer.prompt({title:"请填写驳回的理由",formType:2},function(d,c){layer.close(c);$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendStatus:"2",approveMessage:"驳回的原因："+d},dataType:"json",success:function(e){if(e.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(e){layer.msg("网络错误!",{icon:1,time:1000})}})})});break;case 5:layer.confirm("请到详情页面确认待客单，是否通过？<br/>通过：此单进入保护期&nbsp;&nbsp;驳回：经纪人重新上传",{btn:["通过","驳回"],title:"代客确认单审核"},function(){layer.confirm("确定要通过待客单吗？",function(){$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendFlow:"6",approveMessage:"待客确认单已审核完毕,请在保护期内完成签约!"},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})})},function(){layer.prompt({title:"请填写驳回的理由",formType:2},function(d,c){layer.close(c);$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendFlow:"4",approveMessage:"驳回的原因："+d},dataType:"json",success:function(e){if(e.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(e){layer.msg("网络错误!",{icon:1,time:1000})}})})});break;case 7:layer.confirm("请到详情页面确认签约单，是否通过？<br/>通过：流转甲方确认&nbsp;&nbsp;驳回：经纪人重新上传<br/><br/>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;请确定是否要通过签约单？",{btn:["通过","驳回"],title:"签约单审核"},function(){layer.confirm('最终购房成交金额：<input id="contractMoney" type="text" style="height:22px;" /> 万<br/><br/>推荐佣金：<input id="makeMoney" type="text" style="height:22px;" /> 元',{title:"确认签约单审核"},function(){if(!$("#makeMoney").val()||!$("#contractMoney").val()){return layer.msg("请填写完整后提交!",{icon:1,time:1000})}$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateByMakeMoney",data:{recordId:a,approveMessage:"您的签约单审核完毕，等待确认！",recommendFlow:"8",makeMoney:$("#makeMoney").val(),contractMoney:$("#contractMoney").val()},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})})},function(){layer.prompt({title:"请填写驳回的理由",formType:2},function(d,c){layer.close(c);$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendFlow:"6",approveMessage:"驳回的原因："+d},dataType:"json",success:function(e){if(e.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(e){layer.msg("网络错误!",{icon:1,time:1000})}})})});break;case 9:layer.confirm('确定已经给经纪人打款?<br/>确定：推荐单完成<br/><br/>真实打款金额：<input id="recommendSendmoney" type="text" style="height:22px;" /> 元',function(c){if(!$("#recommendSendmoney").val()){return layer.msg("请填写真实打款金额",{icon:1,time:1000})}$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateByRecommendSendmoney",data:{recordId:a,recommendSendmoney:$("#recommendSendmoney").val(),recommendFlow:"10",approveMessage:"此推荐单已结束，佣金已打致您的账户！"},dataType:"json",success:function(d){if(d.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(d){layer.msg("网络错误!",{icon:1,time:1000})}})});break;case 905:layer.confirm("请复核签约单，并于甲方沟通，是否通过？<br/>通过：流转甲方复核&nbsp;&nbsp;驳回：经纪人重新上传",{btn:["通过","驳回"],title:"代客确认单审核"},function(){layer.confirm("确定要复核签约单吗？",function(){$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendFlow:"8",approveMessage:"待客确认单已审核完毕,请在保护期内完成签约!"},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})})},function(){layer.prompt({title:"请填写驳回的理由",formType:2},function(d,c){layer.close(c);$.ajax({type:"POST",url:urlScope+"/recommendRecord/updateRecommendFlow",data:{recordId:a,recommendFlow:"6",approveMessage:"驳回的原因："+d},dataType:"json",success:function(e){if(e.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(e){layer.msg("网络错误!",{icon:1,time:1000})}})})});break}},recommend_search:function(a){$.ajax({type:"POST",url:urlScope+"/recommendRecord/houtaiByCommunity",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),communityId:$("#communityId").val(),recommendStatus:$("#recommendStatus").val(),recommendFlow:$("#findBySellersId").val()},dataType:"json",success:function(c){var b=panel.packQueryData(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel.recommend_search(d.curr)}}})},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},second_search:function(a){$.ajax({type:"POST",url:urlScope+"/recommendRecord/houtaiByHouse",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),communityId:$("#communityId").val(),recommendStatus:$("#recommendStatus").val(),recommendFlow:$("#findBySellersId").val()},dataType:"json",success:function(c){var b=panel.packQueryData(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel.packQueryData(c)(d.curr)}}})},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},recommendStatus:function(a){$.ajax({type:"POST",dataType:"json",url:urlScope+"/recommendRecord/houtaiByCommunity",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),communityId:$("#communityId").val(),recommendStatus:$("#recommendStatus").val(),recommendFlow:$("#findBySellersId").val()},success:function(c){var b=panel.packQueryData(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel.recommendStatus(d.curr)}}})},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},findBySellersId:function(a){$.ajax({type:"POST",dataType:"json",url:urlScope+"/recommendRecord/houtaiByCommunity",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),communityId:$("#communityId").val(),recommendStatus:$("#recommendStatus").val(),recommendFlow:$("#findBySellersId").val()},success:function(c){var b=panel.packQueryData(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel.findBySellersId(d.curr)}}})},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},describe:function(d,b,a,c){layer_show(d,b,a,c)},packQueryData:function(g){if(g.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var d=g.object;var f=d.data;var b="";for(var e=0;e<f.length;e++){var c="";switch(f[e].recommendStatus){case"1":c="正常";break;case"2":c="取消";break;case"3":c="签约";break;default:c="完成"}var h="";switch(f[e].recommendFlow){case"1":h="已推荐";break;case"2":h="推荐单已审核";break;case"3":h="推荐单已确认";break;case"4":h="上门已确认";break;case"5":h="待客确认单已提交";break;case"6":h="待客确认单已审核";break;case"7":h="签约单已提交";break;case"8":h="签约单已审核";break;case"9":h="签约单已确认";break;case"905":h="运营复核";break;default:h="佣金已发放"}b+='<tr class="text-c"><td>'+(e+1)+"</td><td>"+f[e].recommendUserName+"</td><td>"+f[e].recommendProjectName+"</td><td>"+f[e].recommendUserPhone+"</td><td>"+common.dateFormat(f[e].recommendAddTime.time)+'</td><td class="td-status"><span class="  radius">'+c+'</span> <input type="hidden" value='+f[e].recommendStatus+'> </td><td class="td-status"><span class="  radius">'+h+'</span> <input type="hidden" value='+f[e].recommendFlow+'> </td><td><a href="javascript:;"  onclick=panel.describe("查看详情","recommend-manager-describe.html?id='+f[e].id+'","800","500") class="label label-success radius">详情</a></td><td class="td-status">';if(f[e].recommendFlow=="1"&&f[e].recommendStatus=="1"){b+="<a onClick=panel.updateTo2or6("+f[e].id+","+f[e].recommendFlow+') class="label-success  radius label">信息审核</a>'}if(f[e].recommendFlow=="5"&&f[e].recommendStatus=="1"){b+="<a onClick=panel.updateTo2or6("+f[e].id+","+f[e].recommendFlow+') class="label-success  radius label">带客审核</a>'}if(f[e].recommendFlow=="7"&&f[e].recommendStatus=="1"){b+="<a onClick=panel.updateTo2or6("+f[e].id+","+f[e].recommendFlow+') class="label-success  radius label">签约审核</a>'}if(f[e].recommendFlow=="9"&&f[e].recommendStatus=="3"){b+="<a onClick=panel.updateTo2or6("+f[e].id+","+f[e].recommendFlow+') class="label-success  radius label">打款确认</a>'}if(f[e].recommendFlow=="905"&&f[e].recommendStatus=="1"){b+="<a onClick=panel.updateTo2or6("+f[e].id+","+f[e].recommendFlow+') class="label-success radius label">签约复核</a>'}if(f[e].recommendFlow=="2"){b+='<a  class=" radius label">推荐审核</a>'}if(f[e].recommendFlow=="1"&&f[e].recommendStatus=="2"){b+='<a  class=" radius label">信息未通过</a>'}if(f[e].recommendFlow=="3"){b+='<a  class=" radius label">推荐已确认</a>'}if(f[e].recommendFlow=="4"&&f[e].recommendStatus=="1"){b+='<a  class=" radius label">上门已确认</a>'}if(f[e].recommendFlow=="6"){b+='<a  class=" radius label">带客已审核</a>'}if(f[e].recommendFlow=="8"){b+='<a class="  radius label">签约审核</a>'}if(f[e].recommendFlow=="10"){b+='<a class=" radius label">已打款</a>'}b+="</td></tr>"}$("tbody").html(b);$(".r > strong").html(d.totalNumber);var a=Math.ceil(d.totalNumber/d.pageSize);return a}};$(function(){panel.init();$("#qu").change(function(){panel.bind_communitySelect(this)})});
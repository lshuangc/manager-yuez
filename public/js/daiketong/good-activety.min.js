var panel={init:function(){$("#communityId").val(common.getQueryString("communityId"));$("#id").val(common.getQueryString("id"));this.goodActivetyType();$("#activety_add").unbind("click").bind("click",this.goodActivetyAdd)},goodActivetyAdd:function(){var a=new FormData(document.getElementById("form-add"));if($("#d4311").val()==""||$("#d4312").val()==""||$("#discountInformation").val()==""){layer.msg("请填写完整再提交",{icon:1,time:1000});return}$.ajax({type:"post",dataType:"json",url:urlScope+"/CommunityDetail/addUpDiscountInformation",data:a,processData:false,contentType:false,xhrFields:{withCredentials:true},beforeSend:function(){common.disabledButton("#activety_add")},success:function(b){if(b.result!=1){layer.msg("添加失败!",{icon:1,time:2000})}else{layer.msg("添加成功!",{icon:1,time:2000})}setTimeout(function(){window.location.reload()},2000)},error:function(b,d,c){layer.msg("网络错误",{icon:1,time:2000})}})},goodActivetyType:function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/findDiscountInformation",dataType:"json",data:{communityId:$("#communityId").val(),id:$("#id").val()},success:function(b){b=b.object;if(b.endDiscountTime!=null){var a="";a+='<tr class="text-c"><td>'+b.id+'</td><td ondblclick="panel.ondblclickEditor1(this,'+b.id+')" >'+common.dateFormat(b.startDiscountTime.time)+'</td><td ondblclick="panel.ondblclickEditor2(this,'+b.id+')"  >'+common.dateFormat(b.endDiscountTime.time)+'</td><td ondblclick="panel.ondblclickEditor3(this,'+b.id+')">'+b.discountInformation+'</td><td class="td-manage"><a title="删除" href="javascript:;" onclick=panel.goodActivety_del('+b.id+',"800","500") class="ml-5" style="text-decoration:none"><i class="Hui-iconfont">&#xe6e2;</i></a></td></tr>';$("tbody").html(a)}},error:function(a){layer.msg("网络错误",{icon:1,time:1000})}})},goodActivety_del:function(a){layer.confirm("确认要删除吗？",function(b){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/deleteDiscountInformation",data:{id:a},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("删除数据失败",{icon:1,time:1000});return}layer.msg("已删除!",{icon:1,time:1000});location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})})},ondblclickEditor1:function(a,d){var c=a.innerHTML;var b=document.createElement("input");b.type="text";b.value=c;b.onblur=function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/addUpDiscountInformation",data:{id:d,startDiscountTime:$(this).val()},dataType:"json",success:function(e){panel.goodActivetyType;if(e.result=="0"){layer.msg("修改失败",{icon:1,time:1000});return}else{layer.msg("修改成功",{icon:1,time:1000})}setTimeout(function(){window.location.reload()},1000)}});a.innerHTML=this.value?this.value:c;a.setAttribute("ondblclick","ondblclickEditor1(this);")};a.innerHTML="";a.appendChild(b);b.setSelectionRange(0,c.length);b.focus();b.parentNode.setAttribute("ondblclick","")},ondblclickEditor2:function(a,d){var c=a.innerHTML;var b=document.createElement("input");b.type="text";b.value=c;b.onblur=function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/addUpDiscountInformation",data:{id:d,endDiscountTime:$(this).val()},dataType:"json",success:function(e){panel.goodActivetyType;if(e.result=="0"){layer.msg("修改失败",{icon:1,time:1000});return}else{layer.msg("修改成功",{icon:1,time:1000})}setTimeout(function(){window.location.reload()},1000)}});a.innerHTML=this.value?this.value:c;a.setAttribute("ondblclick","ondblclickEditor2(this);")};a.innerHTML="";a.appendChild(b);b.setSelectionRange(0,c.length);b.focus();b.parentNode.setAttribute("ondblclick","")},ondblclickEditor3:function(a,d){var c=a.innerHTML;var b=document.createElement("input");b.type="text";b.value=c;b.onblur=function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/addUpDiscountInformation",data:{id:d,discountInformation:$(this).val()},dataType:"json",success:function(e){panel.goodActivetyType;if(e.result=="0"){layer.msg("修改失败",{icon:1,time:1000});return}else{layer.msg("修改成功",{icon:1,time:1000})}setTimeout(function(){window.location.reload()},1000)}});a.innerHTML=this.value?this.value:c;a.setAttribute("ondblclick","ondblclickEditor3(this);")};a.innerHTML="";a.appendChild(b);b.setSelectionRange(0,c.length);b.focus();b.parentNode.setAttribute("ondblclick","")}};$(function(){panel.init()});
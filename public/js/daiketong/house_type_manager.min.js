var panel={init:function(){$("#communityId").val(common.getQueryString("communityid"));this.type();this.getCommunityType();$("#type_add").unbind("click").bind("click",this.typeManagerAdd);$("#typeImgurl").change(function(){common.fileType(typeImgurl)})},getCommunityType:function(){$.ajax({type:"POST",url:urlScope+"/CommunityHousetype/getHouseTypesByCommunityId",dataType:"json",data:{communityId:$("#communityId").val()},success:function(c){if(c.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var c=c.object;var a="";for(var b=0;b<c.length;b++){a+='<tr class="text-c"><td>'+(b+1)+'</td><td><img   onclick="panel.ondblclickEdi('+c[b].id+')"  src="'+imgurl+"communitytype/"+c[b].typeImgurl+'" ></td><td>'+c[b].housetypeName+'</td><td ondblclick="panel.ondblclicktypeCommision(this,'+c[b].id+')">'+c[b].typeCommision+'</td><td ondblclick="panel.ondblclickEditortypeArea(this,'+c[b].id+')">'+c[b].typeArea+"</td></tr>"}$("tbody").html(a)},error:function(a){layer.msg("网络错误",{icon:1,time:1000})}})},type:function(){$.ajax({type:"POST",url:urlScope+"/Housetype/findAll",dataType:"json",success:function(d){if(d.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var b=d.object;var a='<option value=" ">全部</option>';for(var c=0;c<b.length;c++){a+="<option value="+b[c].id+">"+b[c].housetypeName+"</option>"}$("#housetypeId").html(a)},error:function(a){layer.msg("网络错误!",{icon:1,time:1000})}})},typeManagerAdd:function(){var a=new FormData(document.getElementById("form-add"));if($("#typeDatail").val()==""||$("#housetypeId").val()==""||$("#typeArea").val()==""||$("#typeImgurl").val()==""||$("#typeCommision").val()==""){layer.msg("请填写完整再提交",{icon:1,time:1000});return}$.ajax({type:"post",dataType:"json",url:urlScope+"/CommunityHousetype/addCommunityHousetype",data:a,processData:false,contentType:false,xhrFields:{withCredentials:true},beforeSend:function(){},success:function(b){if(b.result!=1){layer.msg("户型添加失败!",{icon:1,time:1000})}else{layer.msg("户型添加成功!",{icon:1,time:1000})}window.location.reload()},error:function(b,d,c){layer.msg("网络错误",{icon:1,time:1000})}})},ondblclickEditortypeDatail:function(a,d){var c=a.innerHTML;var b=document.createElement("input");b.type="text";b.value=c;b.onblur=function(){$.ajax({type:"POST",url:urlScope+"/CommunityHousetype/updateCommunityHousetype",data:{id:d,communityId:$("#communityId").val(),typeDatail:$(this).val()},dataType:"json",success:function(e){panel.getCommunityType;if(e.result=="0"){layer.msg("修改失败",{icon:1,time:1000});return}else{if(e.result=="1"){layer.msg("修改成功",{icon:1,time:1000})}else{layer.msg("修改失败，户型已经存在!",{icon:1,time:1000})}}setTimeout(function(){window.location.reload()},1000)}});a.innerHTML=this.value?this.value:c;a.setAttribute("ondblclick","ondblclickEditortypeDatail(this);")};a.innerHTML="";a.appendChild(b);b.setSelectionRange(0,c.length);b.focus();b.parentNode.setAttribute("ondblclick","")},ondblclicktypeCommision:function(a,d){var c=a.innerHTML;var b=document.createElement("input");b.type="text";b.value=c;b.onblur=function(){$.ajax({type:"POST",url:urlScope+"/CommunityHousetype/updateCommunityHousetype",data:{id:d,communityId:$("#communityId").val(),typeCommision:$(this).val()},dataType:"json",success:function(e){panel.getCommunityType;if(e.result=="0"){layer.msg("修改失败",{icon:1,time:1000});return}else{if(e.result=="1"){layer.msg("修改成功",{icon:1,time:1000})}else{layer.msg("修改失败，户型已经存在!",{icon:1,time:1000})}}setTimeout(function(){window.location.reload()},1000)}});a.innerHTML=this.value?this.value:c;a.setAttribute("ondblclick","ondblclickEditortypeDatail(this);")};a.innerHTML="";a.appendChild(b);b.setSelectionRange(0,c.length);b.focus();b.parentNode.setAttribute("ondblclick","")},ondblclickEditortypeArea:function(a,d){var c=a.innerHTML;var b=document.createElement("input");b.type="text";b.value=c;b.onblur=function(){$.ajax({type:"POST",url:urlScope+"/CommunityHousetype/updateCommunityHousetype",data:{id:d,communityId:$("#communityId").val(),typeArea:$(this).val()},dataType:"json",success:function(e){panel.getCommunityType;if(e.result=="0"){layer.msg("修改失败",{icon:1,time:1000});return}else{if(e.result=="1"){layer.msg("修改成功",{icon:1,time:1000})}else{layer.msg("修改失败，户型已经存在!",{icon:1,time:1000})}}setTimeout(function(){window.location.reload()},1000)}});a.innerHTML=this.value?this.value:c;a.setAttribute("ondblclick","ondblclickEditortypeArea(this);")};a.innerHTML="";a.appendChild(b);b.setSelectionRange(0,c.length);b.focus();b.parentNode.setAttribute("ondblclick","")},ondblclickEdi:function(b){var a=$("#communityId").val();layer.confirm('请选择要修改的图片：<br> <br><form id="formImg" enctype ="multipart/form-data"><input type="file" style="height:22px;" id="type" name="typeImgurl"/><input type="text" style="display: none" name="id" value="'+b+'" /><input type="text" style="display: none" name="communityId" value="'+a+'" /></form> ',{btn:["确定","取消"],title:"选择图片"},function(){var c=new FormData(document.getElementById("formImg"));if($("#type").val()==""){return layer.msg("请选择要修改的图片!",{icon:1,time:2000})}$.ajax({type:"POST",url:urlScope+"/CommunityHousetype/updateCommunityHousetype",data:c,dataType:"json",processData:false,contentType:false,xhrFields:{withCredentials:true},success:function(d){if(d.result!="1"){layer.msg("修改失败",{icon:1,time:1000});return}layer.msg("修改成功",{icon:1,time:1000});location.replace(location.href)},error:function(d){layer.msg("网络错误!",{icon:1,time:1000})}})})}};$(function(){panel.init()});
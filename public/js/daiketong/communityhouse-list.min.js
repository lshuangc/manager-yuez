var panel_CommunityHouse={init:function(){common.bind_Sanji();this.findAllCommunity(1)},change_CommunityHouseType:function(b){var a=b.value;switch(a){case"1":this.remove_CommunityHousetypeList();this.findAllCommunity(1);break;case"2":this.remove_CommunityHousetypeList();this.secondHand(1);break}},btn_findByScreen:function(){var a=$("select[name = communityhouse-type]").val();switch(a){case"1":this.communityHouse_search();break;case"2":this.second_search();break}},findAllCommunity:function(a){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/findToHouTai",dataType:"json",data:{page:a||1,rows:10,type:1},success:function(c){var b=panel_CommunityHouse.packQueryData_Community(c,a);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel_CommunityHouse.findAllCommunity(d.curr)}}})},error:function(b){layer.msg("网络错误",{icon:1,time:1000})}})},findAllCommunity2:function(a){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/findToHouTai",dataType:"json",data:{page:a||1,rows:10,type:2},success:function(g){if(g.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var c=g.object;var f=c.data;var d='<thead><tr class="text-c"><th width="30">序号</th><th width="100">小区封面</th><th width="100">小区名称</th><th width="150">小区地址</th><th width="100">户型范围</th><th width="80">面积范围</th><th width="60">均价(元)</th><th width="60">起价(元)</th><th width="60">佣金(元)</th><th width="130">数据添加时间</th><th width="130">最新开盘日期</th><th width="130">最早交房日期</th><th width="100">物业公司</th><th width="100">开发商</th><th width="150">销售商</th><th><select name="" id="detailStatus" onchange="panel_CommunityHouse.detailStatusXuan()"> <option value="">状态</option><option value="0">停用</option><option value="1">启用</option><option value="2">待审核</option><option value="4">未通过</option></select></th><th width="30">操作</th><th width="60">优惠活动</th></tr></thead><tbody>';for(var e=0;e<f.length;e++){var h="";switch(f[e].detailStatus){case"0":h="停用";break;case"1":h="启用";break;case"2":h="待审核";break;case"4":h="未通过";break}d+='<tr class="text-c"><td>'+(e+1)+'</td><td><img src="'+imgurl+"community/"+f[e].imgUrl+'" ></td><td>'+f[e].name+"</td><td>"+f[e].provinceName+","+f[e].cityName+","+f[e].countyName+","+f[e].address+"</td><td>"+f[e].houseTypeRange+"</td><td>"+f[e].houseProportionRange+"</td><td>"+f[e].averagePrice+"</td><td>"+f[e].houseSp+"</td><td>"+f[e].recommendCommission+"</td><td>"+common.dateFormat(f[e].communityDetailAddtime.time)+"</td><td>"+common.dateFormat(f[e].latestSaleTime.time)+"</td><td>"+common.dateFormat(f[e].firstHandTime.time)+"</td><td>"+f[e].propertyName+"</td><td>"+f[e].devloper+"</td><td>"+f[e].sellerCompanyName+'</td><td class="td-status"><span class="">'+h+"</span><input type=hidden  value="+f[e].detailStatus+' id=proStatusId></td><td class="f-14 product-brand-manage">';if(f[e].detailStatus=="0"||f[e].detailStatus=="1"){d+="<a onClick=panel_CommunityHouse.community_stop_start("+f[e].id+","+f[e].detailStatus+') class="label-success  radius label">修改状态</a>'}if(f[e].detailStatus=="2"){d+="<a onClick=panel_CommunityHouse.community_stop_start("+f[e].id+","+f[e].detailStatus+') class="label-success radius label">待审核</a>'}if(f[e].detailStatus=="4"){d+="<a onClick=panel_CommunityHouse.community_stop_start("+f[e].id+","+f[e].detailStatus+') class="label-success radius label">未通过</a>'}d+='</td><td class="td-manage">';if(f[e].detailStatus=="1"){d+='<a href="javascript:;" onclick=panel_CommunityHouse.goodActivety_edit("优惠活动","good-activety2.html?communityId='+f[e].communityId+"&id="+f[e].id+'","1","1000","700") class="label-success  radius label">优惠活动</a>'}if(f[e].detailStatus=="2"||f[e].detailStatus=="0"||f[e].detailStatus=="4"){d+='<a href="javascript:;" onclick=panel_CommunityHouse.community_see2('+f[e].id+","+f[e].detailStatus+') class="label-success radius label">优惠活动</a>'}d+="</td></tr>"}d="</tbody>"+d;$("#CommunityHouse_table").html(d);$(".r > strong").html(c.totalNumber);var b=Math.ceil(c.totalNumber/c.pageSize);return b;laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(i,j){if(!j){panel_CommunityHouse.findAllCommunity(i.curr)}}})},error:function(b){layer.msg("网络错误",{icon:1,time:1000})}})},secondHand:function(f){var b=$("input[name=Screen_name]").val();var c=$("select[name=Screen_provinceCode]").val();var d=$("select[name=Screen_cityCode]").val();var e=$("select[name=Screen_countyCode]").val();var a=$("select[name=Screen_housetypeId]").val();$.ajax({type:"POST",url:urlScope+"/house/findToBackground",dataType:"json",data:{page:f||1,rows:10},success:function(h){var g=panel_CommunityHouse.secondHand_Community(h,f);laypage({cont:$("#pageDiv"),pages:g,skip:true,skin:"#5a98de",groups:5,curr:f||1,jump:function(i,j){if(!j){panel_CommunityHouse.secondHand(i.curr)}}})},error:function(g){layer.msg("网络错误",{icon:1,time:1000})}})},remove_CommunityHousetypeList:function(){$("#CommunityHouse_btn").html(" ");$("#CommunityHouse_table").html(" ")},communityhouseAdd:function(d,b,a,c){layer_show(d,b,a,c)},communitySecondAdd:function(d,b,a,c){layer_show(d,b,a,c)},revis:function(d,b,a,c){layer_show(d,b,a,c)},community_stop_start:function(b,a){switch(a){case 0:layer.confirm("确定要修改为启用吗？",function(c){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/updateCommunityDetail",data:{id:b,detailStatus:1},dataType:"json",success:function(d){if(d.result!="1"){layer.msg("修改为启用失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(d){layer.msg("网络错误!",{icon:1,time:1000})}})});break;case 1:layer.confirm("确定要修改为停用吗？",function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/updateCommunityDetail",data:{id:b,detailStatus:0},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("修改为停用失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})});break;case 2:layer.confirm("请仔细确认是否为通过还是驳回？",{btn:["通过","驳回"],title:"审核小区"},function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/updateCommunityDetail",data:{id:b,detailStatus:1,reviewInformation:"申请已通过"},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})},function(){layer.prompt({title:"请填写未通过理由",formType:2},function(d,c){layer.close(c);$.ajax({type:"POST",url:urlScope+"/CommunityDetail/updateCommunityDetail",data:{id:b,detailStatus:4,reviewInformation:"审核未通过原因："+d},dataType:"json",success:function(e){if(e.result!="1"){layer.msg("驳回失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(e){layer.msg("网络错误!",{icon:1,time:1000})}})})});break}},community_see:function(b,a){switch(a){case 0:layer.confirm("请先在操作栏将状态修改为启用后，才可添加优惠活动",{shadeClose:true,closeBtn:0,title:"优惠活动提示"});break;case 2:layer.confirm("请先在操作栏将待审核通过，然后在操作栏将状态修改为启用后，才可添加优惠活动",{shadeClose:true,closeBtn:0,title:"优惠活动提示"});case 4:layer.confirm("审核未通过，暂时还不添加优惠活动",{shadeClose:true,closeBtn:0,title:"优惠活动提示"})}},community_see2:function(b,a){switch(a){case 0:layer.confirm("请先在操作栏将状态修改为启用后，才可查看优惠活动",{shadeClose:true,closeBtn:0,title:"优惠活动提示"});break;case 2:layer.confirm("请先在操作栏将待审核通过，然后在操作栏将状态修改为启用后，才可查看优惠活动",{shadeClose:true,closeBtn:0,title:"优惠活动提示"});case 4:layer.confirm("审核未通过，暂时还不能查看优惠活动",{shadeClose:true,closeBtn:0,title:"优惠活动提示"})}},secondHand_stop_start:function(b,a){switch(a){case 0:layer.confirm("确定要修改为启用吗？",function(c){$.ajax({type:"POST",url:urlScope+"/house/updatHouse",data:{id:b,houseStatus:1},dataType:"json",success:function(d){if(d.result!="1"){layer.msg("修改为启用失败",{icon:1,time:1000});return}layer.msg("修改为启用成功!",{icon:1,time:1000});setTimeout(function(){window.location.reload()},2000)},error:function(d){layer.msg("网络错误!",{icon:1,time:1000})}})});break;case 1:layer.confirm("确定要修改为停用吗？",function(){$.ajax({type:"POST",url:urlScope+"/house/updatHouse",data:{id:b,houseStatus:0},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("修改为停用失败",{icon:1,time:1000});return}layer.msg("修改为停用成功!",{icon:1,time:1000});setTimeout(function(){window.location.reload()},2000)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})});break;case 2:layer.confirm('请填写推荐佣金比例：<br/><br/><input id="housePercentage" type="text" style="height:22px;" /> %',{btn:["通过","取消"],title:"审核小区"},function(){if($("#housePercentage")==""){layer.msg("请填写推荐佣金比例后提交",{icon:1,time:1000});return}$.ajax({type:"POST",url:urlScope+"/house/updatHouse",data:{id:b,houseStatus:0,housePercentage:$("#housePercentage").val()},dataType:"json",success:function(c){if(c.result!="1"){layer.msg("审核失败",{icon:1,time:1000});return}location.replace(location.href)},error:function(c){layer.msg("网络错误!",{icon:1,time:1000})}})});break}},communityHouse_search:function(a){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/findToHouTai",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),communityName:$("#communityName").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),housetypeId:$("#houseType").val(),detailStatus:$("#detailStatus").val()},dataType:"json",success:function(c){var b=panel_CommunityHouse.packQueryData_Community(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel_CommunityHouse.communityHouse_search(d.curr)}}})},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},second_search:function(a){$.ajax({type:"POST",url:urlScope+"/house/findToBackground",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),name:$("#communityName").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),housetypeId:$("#houseType").val(),houseStatus:$("#detailStatus").val()},dataType:"json",success:function(c){var b=panel_CommunityHouse.secondHand_Community(c);laypage({cont:$("#pageDiv"),pages:b,skip:true,skin:"#5a98de",groups:5,curr:a||1,jump:function(d,e){if(!e){panel_CommunityHouse.second_search(d.curr)}}})},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},detailStatusXuan:function(a){$.ajax({type:"POST",dataType:"json",url:urlScope+"/CommunityDetail/findToHouTai",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),communityName:$("#communityName").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),housetypeId:$("#houseType").val(),detailStatus:$("#detailStatus").val()},success:function(b){panel_CommunityHouse.packQueryData_Community(b,a)},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},secondHandStatus:function(a){$.ajax({type:"POST",dataType:"json",url:urlScope+"/house/findToBackground",data:{page:a||1,rows:10,startTime:$("#datemin").val(),endTime:$("#datemax").val(),name:$("#communityName").val(),provinceCode:$("#sheng").val(),cityCode:$("#shi").val(),countyCode:$("#qu").val(),housetypeId:$("#houseType").val(),houseStatus:$("#houseStatus").val()},success:function(b){panel_CommunityHouse.secondHand_Community(b,a)},error:function(b){layer.msg("网络错误!",{icon:1,time:1000})}})},goodActivety_edit:function(d,b,e,a,c){layer_show(d,b,a,c)},packQueryData_Community:function(c,j){if(c.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var f=c.object;var g=f.data;var e='<a href="javascript:;" onclick="panel_CommunityHouse.findAllCommunity()"  class="btn btn-primary a2 radius"> 内部户型</a>&nbsp;&nbsp;<a href="javascript:;" onclick="panel_CommunityHouse.findAllCommunity2()"  class="btn a2  radius"> 外部户型</a><a href="javascript:;" id="xiangmu" onclick=panel_CommunityHouse.communityhouseAdd("添加户型","communityhouse-list-add.html","800","500") class="btn  ">添加户型</a>';var h='<thead><tr class="text-c"><th width="30">序号</th><th width="100">小区封面</th><th width="100">小区名称</th><th width="150">小区地址</th><th width="100">户型范围</th><th width="80">面积范围</th><th width="60">均价(元)</th><th width="60">起价(元)</th><th width="60">佣金(元)</th><th width="130">数据添加时间</th><th width="130">最新开盘日期</th><th width="130">最早交房日期</th><th width="100">物业公司</th><th width="100">开发商</th><th width="150">销售商</th><th><select name="" id="detailStatus" onchange="panel_CommunityHouse.detailStatusXuan()"> <option value="">状态</option><option value="0">停用</option><option value="1">启用</option><option value="2">待审核</option><option value="4">未通过</option></select></th><th width="30">操作</th><th width="60">优惠活动</th><th width="60">修改内容</th></tr></thead><tbody>';for(var d=0;d<g.length;d++){var a="";switch(g[d].detailStatus){case"0":a="停用";break;case"1":a="启用";break;case"2":a="待审核";break;case"4":a="未通过";break}h+='<tr class="text-c"><td>'+(d+1)+'</td><td><img src="'+imgurl+"community/"+g[d].imgUrl+'" ></td><td>'+g[d].name+"</td><td>"+g[d].provinceName+","+g[d].cityName+","+g[d].countyName+","+g[d].address+"</td><td>"+g[d].houseTypeRange+"</td><td>"+g[d].houseProportionRange+"</td><td>"+g[d].averagePrice+"</td><td>"+g[d].houseSp+"</td><td>"+g[d].recommendCommission+"</td><td>"+common.dateFormat(g[d].communityDetailAddtime.time)+"</td><td>"+common.dateFormat(g[d].latestSaleTime.time)+"</td><td>"+common.dateFormat(g[d].firstHandTime.time)+"</td><td>"+g[d].propertyName+"</td><td>"+g[d].devloper+"</td><td>"+g[d].sellerCompanyName+'</td><td class="td-status"><span class="">'+a+"</span><input type=hidden  value="+g[d].detailStatus+' id=proStatusId></td><td class="f-14 product-brand-manage">';if(g[d].detailStatus=="0"||g[d].detailStatus=="1"){h+="<a onClick=panel_CommunityHouse.community_stop_start("+g[d].id+","+g[d].detailStatus+') class="label-success  radius label">修改状态</a>'}if(g[d].detailStatus=="2"){h+="<a onClick=panel_CommunityHouse.community_stop_start("+g[d].id+","+g[d].detailStatus+') class="label-success radius label">待审核</a>'}if(g[d].detailStatus=="4"){h+="<a onClick=panel_CommunityHouse.community_stop_start("+g[d].id+","+g[d].detailStatus+') class="label-success radius label">未通过</a>'}h+='</td><td class="td-manage">';if(g[d].detailStatus=="1"){h+='<a href="javascript:;" onclick=panel_CommunityHouse.goodActivety_edit("优惠活动","good-activety.html?communityId='+g[d].communityId+"&id="+g[d].id+'","1","1000","700") class="label-success  radius label">优惠活动</a>'}if(g[d].detailStatus=="2"||g[d].detailStatus=="0"||g[d].detailStatus=="4"){h+='<a href="javascript:;" onclick=panel_CommunityHouse.community_see('+g[d].id+","+g[d].detailStatus+') class="label-success radius label">优惠活动</a>'}h+='</td><td class="td-manage"><a href="javascript:;" onclick=panel_CommunityHouse.revis("修改","communityhouse-list-revise.html?revisid='+g[d].id+"&communityId="+g[d].communityId+'","1000","700") class="label-success  radius label">修改</a></td></tr>'}h="</tbody>"+h;$("#CommunityHouse_table").html(h);$("#CommunityHouse_btn").html(e);$(".r > strong").html(f.totalNumber);var b=Math.ceil(f.totalNumber/f.pageSize);return b},secondHand_Community:function(g){if(g.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var b=g.object;var f=b.data;var h='<a href="javascript:;" onclick=panel_CommunityHouse.communitySecondAdd("添加二手房","communityhouse-second-add.html","800","500") class="btn btn-primary radius"><i class="Hui-iconfont">&#xe600;</i> 添加二手房</a>';var c='<thead><tr class="text-c"><th width="30">序号</th><th width="100">户型缩略图</th><th width="100">所属小区名称</th><th width="150">地址</th><th width="100">所属小区的坐标</th><th width="80">户型别名</th><th width="80">户型规格</th><th width="100">二手房名称</th><th width="80">二手房面积</th><th width="70">单价</th><th width="80">推荐佣金</th><th width="50">楼层数</th><th width="50">房号</th><th width="100">数据添加时间</th><th width="50"><select name="" id="houseStatus" onchange="panel_CommunityHouse.secondHandStatus()"> <option value="">二手房状态</option><option value="0">停用</option><option value="1">启用</option><option value="2">待审核</option></select></th><th width="30">操作</th></tr></thead><tbody>';for(var e=0;e<f.length;e++){var d=f[e].houseStatus=="0"?"在售":"已售";var d="";switch(f[e].houseStatus){case"0":d="停用";break;case"1":d="启用";break;case"2":d="待审核";break}c+='<tr class="text-c"><td>'+(e+1)+'</td><td><img src="'+imgurl+"house/"+f[e].typeImgurl+'" ></td><td>'+f[e].name+"</td><td>"+f[e].provinceName+","+f[e].cityName+","+f[e].countyName+","+f[e].address+"</td><td>"+f[e].coordinate+"</td><td>"+f[e].typeDetail+"</td><td>"+f[e].housetypeName+"</td><td>"+f[e].houseName+"</td><td>"+f[e].houseProportion+"</td><td>"+f[e].houseUnitPrice+"</td><td>"+f[e].houseProportion+"</td><td>"+f[e].floorNum+"</td><td>"+f[e].houseCode+"</td><td>"+common.dateFormat(f[e].houseAddtime.time)+'</td><td class="td-status"><span class=" ">'+d+"</span><input type=hidden  value="+f[e].houseStatus+' id=></td><td class="f-14 product-brand-manage">';if(f[e].houseStatus=="0"){c+="<a onClick=panel_CommunityHouse.secondHand_stop_start("+f[e].id+","+f[e].houseStatus+') class="label-success  radius label">修改状态</a>'}if(f[e].houseStatus=="1"){c+="<a onClick=panel_CommunityHouse.secondHand_stop_start("+f[e].id+","+f[e].houseStatus+') class="label-success  radius label">修改状态</a>'}if(f[e].houseStatus=="2"){c+="<a onClick=panel_CommunityHouse.secondHand_stop_start("+f[e].id+","+f[e].houseStatus+') class="label-success  radius label">待审核</a>'}c+="</td></tr>"}c+="</tbody>";$("#CommunityHouse_table").html(c);$("#CommunityHouse_btn").html(h);$(".r > strong").html(b.totalNumber);var a=Math.ceil(b.totalNumber/b.pageSize);return a}};$(function(){panel_CommunityHouse.init();$(document).on("click",".a2",function(){$(this).addClass("btn-primary").siblings().removeClass("btn-primary")});$(document).on("click",".a2:nth-child(2)",function(){$("#xiangmu").hide()})});
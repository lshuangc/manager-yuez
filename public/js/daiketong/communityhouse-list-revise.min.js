var panel={init:function(){$("#communityId").unbind("click").bind("input propertychange",this.changeComn);$("#communityId").unbind("click").bind("focus",this.changeComn);$("#subwayId").unbind("click").bind("input propertychange",this.subway);$("#subwayId").unbind("click").bind("focus",this.subway);$("#propertyId").unbind("click").bind("input propertychange",this.wuye);$("#propertyId").unbind("click").bind("focus",this.wuye);$("#sellersId").unbind("click").bind("input propertychange",this.xiaoshoufang);$("#sellersId").unbind("click").bind("focus",this.xiaoshoufang);$("#imgUrl").change(function(){common.fileType(imgUrl)});this.communityhouse_revise_describe();$("#id").val(common.getQueryString("revisid"));$("#revis_add").unbind("click").bind("click",this.communityhouse_reviseAdd)},communityhouse_revise_describe:function(){$.ajax({type:"POST",url:urlScope+"/CommunityDetail/findById",dataType:"json",data:{id:common.getQueryString("revisid")},success:function(a){if(a.result!="1"){layer.msg("获取数据失败",{icon:1,time:1000});return}var a=a.object;$("#communityId").val(a.name);$("#communityVal").val(a.communityId);$("#latestSaleTime").val(common.dateFormat(a.latestSaleTime.time));$("#firstHandTime").val(common.dateFormat(a.firstHandTime.time));$("#averagePrice").val(a.averagePrice);$("#houseSp").val(a.houseSp);$("#subwayId").val(a.communityLabel)},error:function(a){layer.msg("网络错误",{icon:1,time:1000})}})},communityhouse_reviseAdd:function(){if($("#communityId").val()==""||$("#latestSaleTime").val()==""||$("#firstHandTime").val()==""||$("#averagePrice").val()==""||$("#houseSp").val()==""||$("#subwayId").val()==""||$("#recommendPercentage").val()==""){layer.msg("请填写完整后提交!",{icon:1,time:1000});return}var a=new FormData(document.getElementById("form"));$.ajax({type:"post",url:urlScope+"/CommunityDetail/updateCommunityDetail",data:a,dataType:"json",processData:false,contentType:false,xhrFields:{withCredentials:true},beforeSend:function(){},success:function(b){if(b.result!="1"){layer.msg("修改失败!",{icon:1,time:1000});return}else{layer.msg("修改成功!",{icon:1,time:1000});setTimeout(function(){window.parent.location.reload()},2000)}},error:function(b,d,c){layer.msg("网络错误!",{icon:1,time:1000})}})},subway:function(){$(".subwayList").css("display","block");$.ajax({type:"post",url:urlScope+"/Label/findAll",data:{},success:function(d){var d=JSON.parse(d);var d=d.object;var b="";var a=[];for(var c=0;c<d.length;c++){b+="<li>"+d[c].labelName+"</li>"}a.push(b);$(".subwayList").html(a);$(".subwayList>li").attr("onclick","panel.onblurfu(this)")}})},onblurfu:function(a){if($("#subwayVal").val()==""){$("#subwayId").val(a.textContent);$("#subwayVal").val(a.textContent)}else{if($("#subwayVal").val().indexOf(a.textContent+"")<0){$("#subwayId").val($("#subwayId").val()+","+a.textContent);$("#subwayVal").val($("#subwayVal").val()+","+a.textContent)}$(".subwayList").hide()}},changeComn:function(){$(".communityList").css("display","block");$.ajax({type:"post",url:urlScope+"/Community/findByScreen",data:{name:$("#communityId").val(),page:1,rows:99999999},success:function(e){var c=JSON.parse(e);var b=c.object.data;var a="";for(var d=0;d<b.length;d++){a+="<li value="+b[d].id+">"+b[d].name+"</li>"}$(".communityList").html(a);$(".communityList>li").attr("onclick","panel.onblurfucn(this)")}})},onblurfucn:function(b){$("#communityId").val(b.textContent);$("#communityVal").val(b.value);$(".communityList").hide();var a=b.value;$.ajax({type:"post",url:urlScope+"/CommunityHousetype/getHouseTypesByCommunityId",data:{communityId:a},success:function(g){var d=JSON.parse(g);var c=d.object;if(c){var f="";$("#communityHousetypeId").empty();for(var e=0;e<c.length;e++){f+="<option value="+c[e].id+">"+c[e].housetypeName+"</option>"}$("#communityHousetypeId").append(f)}else{alert("请先给小区添加户型！")}}})}};$(function(){panel.init()});